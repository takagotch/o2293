define(["util-AMD"],function(e){var a=function(){if(console.log("立即执行函数"),!localStorage.cate||!localStorage.childCate||!localStorage.task){console.log("初始化数据库");var e=[{id:0,name:"默认分类",child:[0]}],a=[{id:0,pid:0,name:"默认子分类",child:[-1]}],t=[{id:-1,pid:0,finish:!0,name:"使用说明",date:"2015-06-05",content:"本应用为离线应用，数据将存储在本地硬盘\n\n左侧为分类列表\n中间为当前分类下的任务列表\n右侧为任务详情\n\n可以添加删除分类，添加任务，修改任务，以及给任务标记是否完成等功能\n\nby Gaohaoyang\nhttp://gaohaoyang.github.io "}];localStorage.cate=JSON.stringify(e),localStorage.childCate=JSON.stringify(a),localStorage.task=JSON.stringify(t)}}(),t=function(){return JSON.parse(localStorage.cate)},l=function(e){for(var a=JSON.parse(localStorage.cate),t=0;t<a.length;t++)if(a[t].id==e)return a[t]},n=function(e){var a=l(e),t=0;if(0!==a.child.length)for(var n=0;n<a.child.length;n++){var o=r(a.child[n]);t+=o.child.length}return t},o=function(e){var a=0;if(0!==e.child.length)for(var t=0;t<e.child.length;t++){var l=r(e.child[t]);a+=l.child.length}return a},i=function(){return JSON.parse(localStorage.childCate)},r=function(e){for(var a=JSON.parse(localStorage.childCate),t=0;t<a.length;t++)if(a[t].id==e)return a[t]},c=function(a){if(e.isArray(a)){for(var t=[],l=0;l<a.length;l++)t.push(r(a[l]));return t}},d=function(e){var a=JSON.parse(localStorage.task),t=[];if(void 0!==e){for(var l=0;l<a.length;l++)e?a[l].finish===!0&&t.push(a[l]):a[l].finish===!1&&t.push(a[l]);return t}return a},g=function(e,a){for(var t=[],l=0;l<a.length;l++)a[l].date==e&&t.push(a[l]);return t},s=function(e){for(var a=d(),t=0;t<a.length;t++)if(a[t].id==e)return a[t]},h=function(e,a){var t=[],l=r(e).child;console.log("子分类对象 child 字段内容---->"+l);for(var n=0;n<l.length;n++){var o=s(l[n]);void 0!==a?(console.log(a),a?o.finish===!0&&t.push(o):o.finish===!1&&t.push(o)):t.push(o)}return console.log(t+"----------success"),t},f=function(e,a){for(var t=[],n=l(e).child,o=0;o<n.length;o++)void 0!==a?(console.log(a),t=t.concat(h(n[o],a))):t=t.concat(h(n[o]));return t};console.log(f(0));var u=function(e){if(e){var a=JSON.parse(localStorage.cate),t={};t.id=a[a.length-1].id+1,t.name=e,t.child=[],a.push(t),localStorage.cate=JSON.stringify(a),console.log(a),console.log(t)}else console.log("name is undefined")},S=function(e,a){if(e&&a){var t=JSON.parse(localStorage.childCate),l={};l.id=t[t.length-1].id+1,l.pid=e,l.name=a,l.child=[],t.push(l),localStorage.childCate=JSON.stringify(t),v(e,l.id)}else console.log("pid or name is undefined")},y=function(e){var a=d();return e.id=a[a.length-1].id+1,a.push(e),console.log(e),console.log(a),p(e.pid,e.id),localStorage.task=JSON.stringify(a),e.id},v=function(e,a){for(var t=JSON.parse(localStorage.cate),l=0;l<t.length;l++)t[l].id==e&&t[l].child.push(a);localStorage.cate=JSON.stringify(t)},C=function(a,t){for(var l=JSON.parse(localStorage.cate),n=0;n<l.length;n++)if(l[n].id==a)for(var o=0;o<l[n].child.length;o++)l[n].child[o]==t&&(l[n].child=e.deleteInArray(l[n].child,o));localStorage.cate=JSON.stringify(l)},p=function(e,a){for(var t=i(),l=0;l<t.length;l++)t[l].id==e&&t[l].child.push(a);localStorage.childCate=JSON.stringify(t)},J=function(e){for(var a=d(),t=0;t<a.length;t++)a[t].id==e&&(a[t].finish=!0);localStorage.task=JSON.stringify(a)},N=function(e,a,t,l){for(var n=d(),o=0;o<n.length;o++)n[o].id==e&&(n[o].name=a,n[o].date=t,n[o].content=l);localStorage.task=JSON.stringify(n)},O=function(a){for(var l=[],n=t(),o=0;o<n.length;o++)if(n[o].id==a&&(l=e.deleteInArray(n,o),0!==n[o].child.length))for(var i=0;i<n[o].child.length;i++)k(n[o].child[i]);localStorage.cate=JSON.stringify(l)},k=function(a){for(var t=[],l=i(),n=0;n<l.length;n++)if(l[n].id==a&&(t=e.deleteInArray(l,n),C(l[n].pid,l[n].id),0!==l[n].child.length))for(var o=0;o<l[n].child.length;o++)B(l[n].child[o]);localStorage.childCate=JSON.stringify(t)},B=function(a){for(var t=[],l=d(),n=0;n<l.length;n++)l[n].id==a&&(t=e.deleteInArray(l,n));localStorage.task=JSON.stringify(t)},I=function(){console.log("=============listAllStorage==============");for(var e=0;e<localStorage.length;e++){var a=localStorage.key(e),t=localStorage.getItem(a);console.log("name----->"+a),console.log("value---->"+t),console.log("---------------------")}console.log("======End=======listAllStorage==============")};return{initDataBase:a,queryCates:t,queryCateById:l,queryTasksLengthByCateId:n,queryTasksLengthByCate:o,queryAllChildCates:i,queryChildCatesById:r,queryChildCatesByIdArray:c,queryAllTasks:d,queryTasksByDateInTaskArr:g,queryTaskById:s,queryTasksByChildCateId:h,queryTasksByCateId:f,addCate:u,addChildCate:S,addTask:y,updateCateChildByAdd:v,updateCateChildByDelete:C,updateChildCateChildByAdd:p,updateTaskStatusById:J,updateTaskById:N,deleteCate:O,deleteChildCate:k,deleteTaskById:B,listAllStorage:I}});